(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[320],{6216:function(t,e,n){Promise.resolve().then(n.bind(n,8570))},6463:function(t,e,n){"use strict";var o=n(1169);n.o(o,"useRouter")&&n.d(e,{useRouter:function(){return o.useRouter}}),n.o(o,"useSearchParams")&&n.d(e,{useSearchParams:function(){return o.useSearchParams}})},8570:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return c}});var o=n(7437),a=n(2265),r=n(6463),i=n(1180),s=n(5686);function c(){let t=(0,r.useRouter)(),[e,n]=(0,a.useState)("login"),[c,l]=(0,a.useState)(""),[u,d]=(0,a.useState)(""),[h,m]=(0,a.useState)(""),[f,p]=(0,a.useState)(""),[g,w]=(0,a.useState)(""),[b,y]=(0,a.useState)(""),[x,v]=(0,a.useState)(!1),[j,S]=(0,a.useState)(!1),k="845468314838-f27p5oaq6mgeekosqqvn2f26d2jhscod.apps.googleusercontent.com",E=(0,i.JQ)(),N=(0,a.useMemo)(()=>"login"===e?"".concat(E,"/auth/login"):"".concat(E,"/auth/signup"),[E,e]),T=(0,a.useCallback)(async e=>{S(!0),y(""),w("");try{let o=await fetch("".concat(E,"/auth/google"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({credential:e})}),a=await o.json();if(!o.ok||!a.accessToken||!a.user){var n;throw Error(null!==(n=a.message)&&void 0!==n?n:"Google authentication failed")}(0,s.J1)({accessToken:a.accessToken,user:a.user}),w("Logged in as ".concat(a.user.email," (").concat(a.user.role,").")),"admin"===a.user.role?t.push("/blog/admin/posts"):t.push("/blog")}catch(t){y(t instanceof Error?t.message:"Unable to authenticate")}finally{S(!1)}},[E,t]);async function C(n){n.preventDefault(),v(!0),y(""),w("");try{let n={email:u,password:h};"signup"===e&&(n.name=c,f.trim()&&(n.adminSecret=f.trim()));let a=await fetch(N,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),r=await a.json();if(!a.ok||!r.accessToken||!r.user){var o;throw Error(null!==(o=r.message)&&void 0!==o?o:"Authentication failed")}(0,s.J1)({accessToken:r.accessToken,user:r.user}),w("Logged in as ".concat(r.user.email," (").concat(r.user.role,").")),"admin"===r.user.role?t.push("/blog/admin/posts"):t.push("/blog")}catch(t){y(t instanceof Error?t.message:"Unable to authenticate")}finally{v(!1)}}return(0,a.useEffect)(()=>{if(!k)return;let t="google-identity-script";if(!document.getElementById(t)){let e=document.createElement("script");e.id=t,e.src="https://accounts.google.com/gsi/client",e.async=!0,e.defer=!0,document.body.appendChild(e)}let e=window.setInterval(()=>{let t=window.google,n=document.getElementById("google-auth-btn");t&&n&&(n.innerHTML="",t.accounts.id.initialize({client_id:k,callback:t=>{t.credential&&T(t.credential)}}),t.accounts.id.renderButton(n,{theme:"outline",size:"large",width:320}),window.clearInterval(e))},300);return()=>window.clearInterval(e)},[k,T]),(0,o.jsx)("main",{className:"min-h-screen bg-gradient-to-b from-slate-900 via-slate-800 to-black pt-24",children:(0,o.jsxs)("section",{className:"mx-auto max-w-xl px-6 pb-16",children:[(0,o.jsx)("h1",{className:"text-3xl font-bold text-white",children:"Admin Access"}),(0,o.jsx)("div",{className:"mt-5 flex gap-2",children:(0,o.jsx)("button",{type:"button",onClick:()=>n("login"),className:"rounded-full px-4 py-2 text-sm font-semibold ".concat("login"===e?"bg-emerald-500 text-black":"border border-white/30 text-white"),children:"Login"})}),(0,o.jsxs)("form",{onSubmit:C,className:"mt-6 space-y-4 rounded-2xl border border-white/10 bg-white/5 p-5",children:["signup"===e&&(0,o.jsxs)("label",{className:"block text-sm text-gray-200",children:["Name",(0,o.jsx)("input",{value:c,onChange:t=>l(t.target.value),required:!0,className:"mt-1 w-full rounded-lg border border-white/20 bg-black/40 px-3 py-2 text-white outline-none"})]}),(0,o.jsxs)("label",{className:"block text-sm text-gray-200",children:["Email",(0,o.jsx)("input",{type:"email",value:u,onChange:t=>d(t.target.value),required:!0,className:"mt-1 w-full rounded-lg border border-white/20 bg-black/40 px-3 py-2 text-white outline-none"})]}),(0,o.jsxs)("label",{className:"block text-sm text-gray-200",children:["Password",(0,o.jsx)("input",{type:"password",value:h,onChange:t=>m(t.target.value),required:!0,minLength:6,className:"mt-1 w-full rounded-lg border border-white/20 bg-black/40 px-3 py-2 text-white outline-none"})]}),"signup"===e&&(0,o.jsxs)("label",{className:"block text-sm text-gray-200",children:["Admin Secret (optional)",(0,o.jsx)("input",{value:f,onChange:t=>p(t.target.value),className:"mt-1 w-full rounded-lg border border-white/20 bg-black/40 px-3 py-2 text-white outline-none"})]}),(0,o.jsx)("button",{type:"submit",disabled:x,className:"w-full rounded-lg bg-emerald-500 px-4 py-2 text-sm font-semibold text-black transition hover:bg-emerald-400 disabled:opacity-60",children:x?"Please wait...":"login"===e?"Login":"Signup"}),"login"===e&&k&&(0,o.jsxs)("div",{className:"pt-2",children:[(0,o.jsx)("p",{className:"mb-2 text-center text-xs uppercase tracking-wide text-gray-300",children:"Or continue with"}),(0,o.jsx)("div",{className:"flex justify-center",children:(0,o.jsx)("div",{id:"google-auth-btn"})}),j&&(0,o.jsx)("p",{className:"mt-2 text-center text-xs text-gray-300",children:"Signing in with Google..."})]})]}),b&&(0,o.jsx)("p",{className:"mt-4 rounded-lg bg-rose-500/15 px-4 py-3 text-sm text-rose-200",children:b}),g&&(0,o.jsx)("p",{className:"mt-4 rounded-lg bg-emerald-500/15 px-4 py-3 text-sm text-emerald-200",children:g}),"login"===e?(0,o.jsx)("div",{className:"mt-5 text-center",children:(0,o.jsx)("button",{type:"button",onClick:()=>n("signup"),className:"text-sm font-semibold text-emerald-300 hover:text-emerald-200",children:"New user? Signup"})}):(0,o.jsx)("div",{className:"mt-5 text-center",children:(0,o.jsx)("button",{type:"button",onClick:()=>n("login"),className:"text-sm font-semibold text-emerald-300 hover:text-emerald-200",children:"Already have account? Login"})})]})})}},1180:function(t,e,n){"use strict";var o;n.d(e,{BC:function(){return E},Cw:function(){return f},Dj:function(){return p},JQ:function(){return r},Mk:function(){return k},OW:function(){return c},QP:function(){return N},T:function(){return u},T6:function(){return i},TO:function(){return y},Uw:function(){return S},X2:function(){return d},dd:function(){return b},h9:function(){return g},jk:function(){return j},jw:function(){return h},lL:function(){return l},nf:function(){return m},rX:function(){return s},s9:function(){return w},uE:function(){return x},w6:function(){return v}});let a=null!==(o="http://localhost:5000".replace(/\/$/,""))&&void 0!==o?o:"http://localhost:5000";function r(){return a}async function i(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"no-store",r=new URLSearchParams({page:String(t),limit:String(e)});n.trim()&&r.set("q",n.trim());let i=await fetch("".concat(a,"/posts?").concat(r.toString()),{method:"GET",cache:o});if(!i.ok)throw Error("Unable to fetch posts");let s=await i.json();return Array.isArray(s)?{items:s,total:s.length,page:1,limit:e,totalPages:1}:s}async function s(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=await fetch("".concat(a,"/posts/admin/all?limit=").concat(e),{method:"GET",headers:{Authorization:"Bearer ".concat(t)},cache:"no-store"});if(!n.ok)throw Error("Unable to fetch admin posts");return await n.json()}async function c(t,e){let n=await fetch("".concat(a,"/posts/admin/").concat(e),{method:"GET",headers:{Authorization:"Bearer ".concat(t)},cache:"no-store"});if(!n.ok)throw Error("Unable to fetch post");return await n.json()}async function l(t,e){let n=new FormData;n.append("file",e);let o=await fetch("".concat(a,"/posts/admin/upload-image"),{method:"POST",headers:{Authorization:"Bearer ".concat(t)},body:n});if(!o.ok)throw Error("Image upload failed");let r=await o.json();if(!r.url)throw Error("No image URL returned from server");return r.url}async function u(t,e){let n=new FormData;n.append("file",e);let o=await fetch("".concat(a,"/student-articles/upload-image"),{method:"POST",headers:{Authorization:"Bearer ".concat(t)},body:n});if(!o.ok)throw Error("Image upload failed");let r=await o.json();if(!r.url)throw Error("No image URL returned from server");return r.url}async function d(t){let{token:e,...n}=t,o=await fetch("".concat(a,"/student-articles"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(n)});if(!o.ok){var r;throw Error(null!==(r=(await o.json()).message)&&void 0!==r?r:"Article submission failed")}return o.json()}async function h(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=new URLSearchParams({page:String(t),limit:String(e)});n.trim()&&o.set("q",n.trim());let r=await fetch("".concat(a,"/student-articles?").concat(o.toString()),{method:"GET",cache:"no-store"});if(!r.ok)throw Error("Unable to fetch student articles");return await r.json()}async function m(t){var e;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=new URLSearchParams;n.status&&o.set("status",n.status),n.page&&o.set("page",String(n.page)),n.limit&&o.set("limit",String(n.limit)),(null===(e=n.q)||void 0===e?void 0:e.trim())&&o.set("q",n.q.trim());let r=await fetch("".concat(a,"/student-articles/admin/all?").concat(o.toString()),{method:"GET",headers:{Authorization:"Bearer ".concat(t)},cache:"no-store"});if(!r.ok)throw Error("Unable to fetch student articles");return await r.json()}async function f(t,e,n){let o=await fetch("".concat(a,"/student-articles/admin/").concat(e,"/approve"),{method:"PATCH",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify(null!=n?n:{})});if(!o.ok)throw Error("Unable to approve article");return o.json()}async function p(t,e){let n=await fetch("".concat(a,"/student-articles/admin/").concat(e,"/reject"),{method:"PATCH",headers:{Authorization:"Bearer ".concat(t)}});if(!n.ok)throw Error("Unable to reject article");return n.json()}async function g(t){let e=new FormData;e.append("file",t);let n=await fetch("".concat(a,"/tutor-applications/upload-resume"),{method:"POST",body:e});if(!n.ok)throw Error("Resume upload failed");let o=await n.json();if(!o.url)throw Error("No resume URL returned from server");return o.url}async function w(t){let e=await fetch("".concat(a,"/tutor-applications"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok){var n;throw Error(null!==(n=(await e.json()).message)&&void 0!==n?n:"Tutor application failed")}return e.json()}async function b(t){var e;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=new URLSearchParams;n.status&&o.set("status",n.status),n.page&&o.set("page",String(n.page)),n.limit&&o.set("limit",String(n.limit)),(null===(e=n.q)||void 0===e?void 0:e.trim())&&o.set("q",n.q.trim());let r=await fetch("".concat(a,"/tutor-applications/admin/all?").concat(o.toString()),{method:"GET",headers:{Authorization:"Bearer ".concat(t)},cache:"no-store"});if(!r.ok)throw Error("Unable to fetch tutor applications");return await r.json()}async function y(t,e,n){let o=await fetch("".concat(a,"/tutor-applications/admin/").concat(e,"/status"),{method:"PATCH",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify(n)});if(!o.ok)throw Error("Unable to update tutor application");return o.json()}async function x(t){let e=await fetch("".concat(a,"/subscribers/email"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok){var n;throw Error(null!==(n=(await e.json()).message)&&void 0!==n?n:"Subscriber signup failed")}return e.json()}async function v(){let t=await fetch("".concat(a,"/subscribers/push-public-key"),{method:"GET",cache:"no-store"});if(!t.ok)throw Error("Unable to fetch push public key");return t.json()}async function j(t){let e=await fetch("".concat(a,"/subscribers/push"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok){var n;throw Error(null!==(n=(await e.json()).message)&&void 0!==n?n:"Push subscription failed")}return e.json()}async function S(t){var e;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=new URLSearchParams;n.page&&o.set("page",String(n.page)),n.limit&&o.set("limit",String(n.limit)),(null===(e=n.q)||void 0===e?void 0:e.trim())&&o.set("q",n.q.trim());let r=await fetch("".concat(a,"/subscribers/admin/email?").concat(o.toString()),{method:"GET",headers:{Authorization:"Bearer ".concat(t)},cache:"no-store"});if(!r.ok)throw Error("Unable to fetch subscribers");return r.json()}async function k(t,e,n){let o=await fetch("".concat(a,"/subscribers/admin/email/").concat(e),{method:"PATCH",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({isActive:n})});if(!o.ok)throw Error("Unable to update subscriber");return o.json()}async function E(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,o=new URLSearchParams({page:String(e),limit:String(n)}),r=await fetch("".concat(a,"/comments/post/").concat(encodeURIComponent(t),"?").concat(o.toString()),{method:"GET",cache:"no-store"});if(!r.ok)throw Error("Unable to fetch comments");return r.json()}async function N(t,e,n){let o=await fetch("".concat(a,"/comments/post/").concat(encodeURIComponent(e)),{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({content:n})});if(!o.ok){var r;throw Error(null!==(r=(await o.json()).message)&&void 0!==r?r:"Unable to post comment")}return o.json()}},5686:function(t,e,n){"use strict";n.d(e,{DH:function(){return s},Gi:function(){return a},J1:function(){return r},v0:function(){return i}});let o="blog_admin_auth",a="blog-auth-changed";function r(t){localStorage.setItem(o,JSON.stringify(t)),window.dispatchEvent(new Event(a))}function i(){let t=localStorage.getItem(o);if(!t)return null;try{return JSON.parse(t)}catch(t){return null}}function s(){localStorage.removeItem(o),window.dispatchEvent(new Event(a))}}},function(t){t.O(0,[971,23,744],function(){return t(t.s=6216)}),_N_E=t.O()}]);